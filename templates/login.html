{% extends 'base.html' %}
{% block content %}

<h2>Login with Mobile</h2>

<div id="mobileBox">
    <input type="text" id="mobile" placeholder="Enter mobile number">
    <button onclick="sendOTP()">CONTINUE</button>
</div>

<div id="otpBox" style="display:none;">
    <input type="text" id="otp" placeholder="Enter OTP">
    <button onclick="verifyOTP()">VERIFY</button>
</div>

<script>
function sendOTP() {
    fetch('/api/accounts/send-otp/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            mobile: document.getElementById('mobile').value
        })
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        document.getElementById('mobileBox').style.display = 'none';
        document.getElementById('otpBox').style.display = 'block';
    });
}

function verifyOTP() {
    fetch('/api/accounts/verify-otp/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            mobile: document.getElementById('mobile').value,
            otp: document.getElementById('otp').value
        })
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        window.location.href = '/';
    });
}
</script>

{% endblock %}
